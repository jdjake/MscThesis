%% The following is a directive for TeXShop to indicate the main file
%%!TEX root = diss.tex

\chapter{Future Work}
\label{ch:Conclusions}

To conclude this thesis, we sketch some ideas developing the theory of `rough sets avoiding patterns', which we introduced in Chapter \ref{ch:RoughSets}. Section 6.1 attempts to exploit additional geometric information about certain rough configurations to find sets with large Hausdorff dimension avoiding patterns, and Section 6.2 studies the problem of finding a set avoiding a rough configuration which supports a measure with large Fourier decay.

\section{Low Rank Avoidance}

One way we can extend the results of Chapter \ref{ch:RoughSets} is to utilize addition geometric structure of the rough configuration $\C$ to obtain larger avoiding sets. Recall that in Chapter \ref{ch:RoughSets}, we studied the avoidance problem for configurations with low Minkowski dimension. This condition means precisely that these configurations are efficiently covered by cubes at all scales. The idea of this section is to study configurations which are efficiently covered by other families of geometric objects at all scales, i.e. by a family of thickened hyperplanes, or by a family of thickened lines. Note that a set $E$ is efficiently covered by a family of thickened parallel hyperplanes at all scales if and only, for a linear transformation $M$ with that hyperplane as a kernel, $M(E)$ has low Minkowski dimension.

\begin{theorem} \label{theorem9063909014901}
    Let $\C \subset \C(\RR)$ be the countable union of sets $\{ \C_i \}$ such that
    %
    \begin{itemize}
        \item For each $i$, there exists $n_i$ such that $\C_i$ is a pre-compact subset of $\C^{n_i}(\RR)$.

        \item There exists an integer $m_i > 0$ and $s_i \in [0,m_i)$, together with a full-rank rational-coefficient linear transformation $M_i: \RR^{n_i} \to \RR^{m_i}$ such that $M_i(\C_i)$ has lower Minkowski dimension at most $s_i$.
    \end{itemize}
    %
    Then there exists a set $X \subset [0,1]$ avoiding $\C$ with Hausdorff dimension at least
    %
    \[ \inf_i \left( \frac{m_i - s_i}{m_i} \right). \]
\end{theorem}

\begin{remarks}
    \
    \begin{enumerate}
        \item[1.] A useful feature of this method is that the resulting set does not depend on the number of points in a configuration. This is a feature only shared by Math\'{e}'s result, Theorem \ref{mathemainresult} in Section 3.3. We exploit this feature later on in this section to find large subsets avoiding a countable family of equations with arbitrarily many variables.

        \item[2.] It might be expected, based on the result of Theorem \ref{mainTheorem}, that one should be able to obtain a set $X \subset [0,1]$ avoiding $\C$ with Hausdorff dimension
        %
        \[ \inf_i \left( \frac{m_i - s_i}{m_i - 1} \right), \]
        %
        whenever $s_i \geq 1$ for all $i$. We plan to pursue this question in further research.

        \item[3.] Also note that the theorem only applies in the one-dimensional configuration avoidance setting. We also plan to find higher dimensional analogues to this theorem, when $d > 1$, in the near future.
    \end{enumerate}
\end{remarks}

For purpose of brevity, here we only describe a solution to the discretized version of the problem. This can be fleshed out into a full proof of Theorem \ref{theorem9063909014901} by techniques analogous to those given in Chapters \ref{ch:RelatedWork} and \ref{ch:RoughSets}. Thus we discuss a single linear transformation $M: \RR^{dn} \to \RR^m$, and try to avoid a discretized version of a low dimensional set.

Before we describe the discretized result, let us simplify the problem slightly. Since our transformation $M$ has full rank, we may find indices
%
\[ i_1, \dots, i_m \in \{ 1, \dots, n \} \]
%
such that the transformation $M$ is invertible when restricted to the span of $\{ e_{i_1}, \dots, e_{i_m} \}$. By an affine change of coordinates in the range of $M$, which preserves the Minkowski dimension of any set, we may assume without loss of generality that $M(e_{i_j}) = e_j$ for each $1 \leq j \leq m$.

\begin{theorem} \label{theorem059891891829}
    Fix $s \in [0,m)$ and $\varepsilon \in [0, (m-s)/2)$. Let $T_1, \dots, T_n \subset [0,1]$ be disjoint, $\DQ_k$ discretized sets, and let $B \subset \RR^m$ be a $\DQ_{k+1}$ discretized set such that
    %
    \begin{equation} \label{equation6091904232093}
        \#(\DQ_{k+1}(B)) \leq N_{k+1}^{s + \varepsilon}.
    \end{equation}
    %
    Then there exists a constant $C(n,m,M) > 0$, and an integer constant $A(M) > 0$, such that if $A(M) \divides N_{k+1}$, and 
    %
    \begin{equation} \label{equation19024u1298352389}
        N_{k+1} > C(n,m,M) \cdot M_{k+1}^{\frac{m}{m - (s + \varepsilon)}}.
    \end{equation}
    %
    then there exists $\DQ_{k+1}$ discretized sets $S_1 \subset T_1$, \dots, $S_n \subset T_n$ such that
    %
    \begin{enumerate}
        \item For any collection of $n$ distinct cubes $Q_i \in \DQ_{k+1}(S_i)$,
        %
        \[ Q_1 \times \dots \times Q_n \not \in \DQ_{k+1}(B). \]

        \item For each $i$, and for each $Q \in \DQ_k(T_i)$, there exists $\DR_Q \subset \DR_{k+1}(Q)$ such that
        %
        \[ \#(\DR_Q) \geq \frac{\#(\DR_{k+1}(Q))}{A(M)}, \]
        %
        and if $R \in \DR_{k+1}(Q)$,
        %
        \[ \#(\DQ_{k+1}(R \cap S_i)) = \begin{cases} 1 &: R \in \DR_Q, \\ 0 &: R \not \in \DR_Q. \end{cases} \]
    \end{enumerate}
\end{theorem}
\begin{proof}
    For each $i \not \in \{ i_1, \dots, i_m \}$, there are rational numbers $a_{ij} = p_{ij}/q_{ij} \in \mathbf{Q}$ such that $M(e_i) = \sum a_{ij} e_j$. Set $A(M) = \prod_{ij} q_{ij}$. For each interval $R \in \DR_{k+1}(T_i)$, we let
    %
    \[ a(R) \in \{ 0, \dots, N_1 \dots N_k M_{k+1} - 1 \} \]
    %
    be the unique integer such that
    %
    \[ R = \left[ \frac{a(R)}{N_1 \dots N_k M_{k+1}}, \frac{a(R) + 1}{N_1 \dots N_k M_{k+1}} \right]. \]
    %
    Let $X \in \{ 0, \dots, N_{k+1}/M_{k+1} - 1 \}^m$. For each $1 \leq j \leq m$, define
    %
    \[ S_{i_j}(X) = \bigcup_{R \in \DR_{k+1}(T_{i_j})} \left[ \frac{a(R)}{N_1 \dots N_k M_{k+1}} + \frac{X_j}{N_1 \dots N_{k+1}}, \frac{a(R)}{N_1 \dots N_k M_{k+1}} + \frac{X_j + 1}{N_1 \dots N_{k+1}} \right]. \]
    %
    For $i \not \in \{ i_1, \dots, i_m \}$, define
    %
    \[ S_i(X) = \bigcup_{\substack{R \in \DR_{k+1}(T_i)\\ \prod q_{ij} \divides a(R)}} \left[ \frac{a(R)}{N_1 \dots N_k M_{k+1}}, \frac{a(R)}{N_1 \dots N_k M_{k+1}} + \frac{1}{N_1 \dots N_{k+1}} \right] \]
    %
    For each $i$, we let $\mathcal{S}_i(X)$ denote the set of startpoints to intervals in $S_i$. Then
    %
    \[ \mathcal{S}_{i_j}(X) \subset \frac{\ZZ}{N_1 \dots N_k M_{k+1}} + \frac{X_j}{N_1 \dots N_{k+1}} \]
    %
    and for $i \not \in \{ i_1, \dots, i_m \}$,
    %
    \[ \mathcal{S}_i(X) \subset \frac{\prod q_{ij}}{N_1 \dots N_k M_{k+1}}. \]
    %
    It therefore follows that if
    %
    \[ \mathcal{A}(X) = M(\mathcal{S}_1(X) \times \dots \times \mathcal{S}_n(X)), \]
    %
    then
    %
    \[ \mathcal{A}(X) \subset \frac{\ZZ^m}{N_1 \dots N_k M_{k+1}} + \frac{X}{N_1 \dots N_{k+1}}. \]
    %
    In particular, if $X \neq X'$, $\mathcal{A}(X)$ and $\mathcal{A}(X')$ are disjoint. Equation \eqref{equation19024u1298352389} implies there is a constant $C(n,m,M)$, such that
    %
    \[ \# \left\{ n \in \mathbf{Z}^m : d \left( \frac{n}{N_1 \dots N_{k+1}}, B \right) \leq \frac{2}{\sqrt{d} \cdot \| M \|} \frac{1}{N_1 \dots N_{k+1}} \right\} \leq C(n,m,M)^{m - (s + \varepsilon)} \cdot N_{k+1}^{s + \varepsilon}. \]
    %
    Applying the pigeonhole principle and \eqref{equation6091904232093}, there exists some value $X_0$ such that
    %
    \begin{align*}
        \# \left\{ n \in \mathbf{A}(X_0) : d(n,B) \leq \frac{2}{\sqrt{d} \cdot \| M \|} \frac{1}{N_1 \dots N_{k+1}} \right\} &\leq \frac{C(n,m,M)^{m - (s + \varepsilon)} \cdot N_{k+1}^{s + \varepsilon}}{(N_{k+1}/M_{k+1})^m}\\
        &\leq \frac{C(n,m,M)^{m - (s + \varepsilon)} \cdot M_{k+1}^m}{N_{k+1}^{m - (s + \varepsilon)}} < 1.
    \end{align*}
    %
    In particular, this set is actually empty. But this means that the set
    %
    \[ M(S_1(X_0) \times \dots \times S_n(X_0)) \]
    %
    is disjoint from $B$. Taking $S_i = S_i(X_0)$ for each $i$ completes the proof.
\end{proof}

Before we move on, let's consider one application of Theorem \ref{theorem9063909014901}, which gives an extension of Theorem \ref{sumset-application} to arbitrarily large sums.

\begin{theorem}
    Let $Y \subset \RR$ be a countable union of pre-compact sets with lower Minkowski dimension at most $t$. Then there exists a set $X \subset \RR$ with Hausdorff dimension at least $1 - t$ such that for any integer $n > 0$, for any $a_1, \dots, a_n \in \QQ$, and for any $x_1, \dots, x_n \in X$,
    %
    \[ (a_1X + \dots + a_n X) \cap Y \subset (0). \]
\end{theorem}
\begin{proof}
    Let $Y = \bigcup_{i = 1}^\infty Y_i$, where each $Y_i$ has lower Minkowski dimension at most $t$. For each $n$, $i$, and $a = (a_1, \dots, a_n) \in \QQ^n$ with $a \neq 0$, let
    %
    \[ \C_{n,a,i} = \{ (x_1, \dots, x_n) \in \C^n : a_1x_1 + \dots + a_nx_n \in Y_i \}, \]
    %
    and let $\C = \bigcup \C_{n,a,i}$. Let $T_{n,i,a}(x_1,\dots,x_n)$ be the linear map given by
    %
    \[ T_{n,a}(x_1,\dots,x_n) = a_1x_1 + \dots + a_nx_n. \]
    %
    Then $T_{n,a}$ is nonzero, and $T_{n,a}(\C_{n,i,a})$ how lower Minkowski dimension at most $t$. Applying Theorem \ref{theorem9063909014901}, we obtain a set $X \subset [0,1]$ avoiding $\C$ with Hausdorff dimension at least $1 - t$.

    We prove $X$ satisfies the conclusions of this theorem by induction on $n$. Consider the case $n = 1$, and fix $a \in \QQ$. If $a \neq 0$, then because $X$ avoids $\C_{a,i}$ for each $i$, if $x \in X$, $ax \not \in Y$, so $aX \cap Y = \emptyset$. If $a = 0$, then $aX = 0$, so $(aX) \cap Y \subset (0)$.

    In general, consider $a = (a_1, \dots, a_{n+1}) \in \QQ^{n+1}$. If $a \neq 0$, then because $X$ avoids $\C_{n,a,i}$ for each $i$, we know if $x_1, \dots, x_{n+1} \in X$ are distinct, then $a_1 x_1 + \dots + a_{n+1} x_{n+1} \not \in Y$. If the values $x_1, \dots, x_{n+1} \in X$ are not distinct, then by rearranging both the values $\{ x_i \}$ and $\{ a_i \}$, we may without loss of generality assume that $x_n = x_{n+1}$. Then
    %
    \begin{align*}
        a_1 x_1 + \dots + a_{n+1} x_{n+1} &= a_1 x_1 + \dots + a_{n-1} x_{n-1} + (a_n + a_{n+1}) x_n\\
        &\subset (a_1 X + \dots + a_{n-1} X + (a_n + a_{n+1}) X).
    \end{align*}
    %
    By induction,
    %
    \[ (a_1 X + \dots + a_{n-1} X + (a_n + a_{n+1}) X) \cap Y \subset (0), \]
    %
    so we conclude that either $a_1 x_1 + \dots + a_{n+1} x_{n+1} \not \in Y$, or $a_1x_1 + \dots + a_{n+1} x_{n+1} = 0$. The only remaining case we have not covered is if $a \in \QQ^{n+1}$ is equal to zero. But in this case,
    %
    \[ (a_1 X + \dots + a_n X) = (0 + \dots + 0) = 0, \]
    %
    and so it is trivial that $(a_1 X + \dots + a_n X) \cap Y \subset (0)$.
\end{proof}

\section{Fourier Dimension}

Recently, there has been much interest in determining whether sets with large Fourier dimension can avoid configurations. Rcesults published recently in the literature include \cite{PramanikLaba} and \cite{Shmerkin}. In this Section, we attempt to modify the procedure of Theorem \ref{mainTheorem} to obtain a set with large Fourier dimension. In this section, we obtain such a result, though with a suboptimal dimension to what we expect from Theorem \ref{mainTheorem}. Furthermore, we restrict ourself to $d = 1$, so that issues involving smoothness do not concern us. We hope to obtain a method which gives an improved bound, and applies to sets in higher dimensional space, in the near future.

\begin{theorem} \label{FourierTheorem}
    Suppose $\C$ is a configuration on $\RR$, formed from the countable union of pre-compact sets, each with lower Minkowski dimension at most $s$. Then there exists a set $X \subset [0,1]$ with Fourier dimension at least $(n - s)/n$ avoiding $\C$.
\end{theorem}

We begin with a lemma which simplifies the analysis of the Fourier decay of the probability measures we study to the analysis of frequencies in $\ZZ^d$.

\begin{lemma} \label{discretefouriermeasures}
    Suppose $\mu$ is a compactly supported finite Borel measure on $\RR^d$, consider $s > 0$, and suppose there exists a constant $C$ such that for each $m \in \ZZ^d$,
    %
    \begin{equation} \label{mufourierbound1}   
        |\widehat{\mu}(m)| \leq C |m|^{-s/2}.
    \end{equation} 
    %
    Then there exists a constant $C'$ such that for each $|\xi| \in \RR^d$,
    %
    \begin{equation} \label{mufourierbound2}
        |\widehat{\mu}(\xi)| \lesssim C' |\xi|^{-s/2}.
    \end{equation}
    %
    In particular, $\mu$ has Fourier dimension $s$.
\end{lemma}
\begin{proof}
    Without loss of generality, we may assume that $\mu$ is supported on a compact subset of $[1/3,2/3)^d$, since every compactly supported measure is a finite sum of translates of measures of this form. Consider the distribution $\Lambda = \sum_{m \in \mathbf{Z}^d} \delta_m$, where $\delta_m$ is the Dirac delta distribution at $m$. Then the Poisson summation formula says that the Fourier transform of $\Lambda$ is itself. If $\psi \in C_c(\RR^d)$ is a bump function supported on $[0,1)^d$, with $\psi(x) = 1$ for $x \in [1/3,2/3)^d$, then $\mu = \psi (\Lambda * \mu)$, so
    %
    \begin{equation} \label{mubounded}
    \begin{split}
        |\widehat{\mu}(\xi)| &= \left| \left[ \widehat{\psi} * (\Lambda \widehat{\mu}) \right](\xi) \right|\\
        &= \left| \sum_{m \in \mathbf{Z}^d} \widehat{\mu}(m)(\widehat{\psi} * \delta_m)(\xi) \right|\\
        &= \left| \sum_{m \in \mathbf{Z}^d} \widehat{\mu}(m) \widehat{\psi}(\xi - m) \right|.
%       &\lesssim \sum_{n \in \mathbf{Z}^d} |\widehat{\mu}(n)| \prod_{i = 1}^d \frac{1}{1 + |n_i - \xi_i|}
    \end{split}
    \end{equation}
    %
    Since $\psi$ is smooth, we know that for all $\eta \in \RR^d$, $|\widehat{\psi}(\eta)| \lesssim 1/|\eta|^{d+1}$. If we perform a dyadic decomposition, we find
    %
    \begin{equation}
        \label{calculation1}
    \begin{split}
        \sum_{1 \leq |m - \xi| \leq |\xi|/2} |\widehat{\mu}(m)| |\widehat{\psi}(\xi - m)| &\lesssim \sum_{1 \leq |m - \xi| \leq |\xi|/2} |\xi|^{-s/2} |\widehat{\psi}(\xi - m)|\\
        &\lesssim \sum_{k = 1}^{\log |\xi|} \sum_{\frac{|\xi|}{2^{k+1}} \leq |m - \xi| \leq \frac{|\xi|}{2^{k}}} |\xi|^{-s/2} \left( 2^k/|\xi| \right)^{d+1}\\
        &\lesssim \sum_{k = 1}^{\log |\xi|} |\xi|^{-s/2} (2^k / |\xi| ) \lesssim |\xi|^{-s/2}.
    \end{split}
    \end{equation}
    %
    There are $O(1)$ points $m \in \mathbf{Z}^d$ with $|m - \xi| \leq 1$, so if $|\xi| \geq 2$,
    %
    \begin{equation} \label{calculation2}
        \sum_{|m - \xi| \leq 1} |\widehat{\mu}(m)| |\widehat{\psi}(m - \xi)| \lesssim |\xi|^{-s/2}.
    \end{equation}
    %
    We can also perform another dyadic decomposition, using the fact that for all $\eta \in \RR^d$, $|\widehat{\psi}(\eta)| \lesssim 1/|\eta|^{2d}$, to find that
    %
    \begin{equation} \label{calculation3}
    \begin{split}
        \sum_{|m - \xi| \geq |\xi|/2} |\widehat{\mu}(m)| |\widehat{\psi}(m - \xi)| &\lesssim \sum_{k = 0}^\infty \sum_{|\xi| 2^{k-1} \leq |m - \xi| \leq |\xi| 2^k} \frac{|\widehat{\mu}(m)|}{|\xi|^{2d} 2^{2dk}}\\
        &\lesssim \sum_{k = 0}^\infty |\xi|^{-d} 2^{-dk} \lesssim |\xi|^{-d}.
    \end{split}
    \end{equation}
    %
    Combining \eqref{calculation1}, \eqref{calculation2}, and \eqref{calculation3} with \eqref{mubounded}, we conclude that if $|\xi| \geq 2$,
    %
    \begin{equation} \label{endequation53}
        |\widehat{\mu}(\xi)| \lesssim |\xi|^{-s/2}.
    \end{equation}
    %
    Since $\widehat{\mu}$ is bounded, \eqref{endequation53} actually holds for all $\xi \in \RR^d$.
\end{proof}

Our goal now is to carefully modify the discrete selection strategy and discretized probability measures we use to obtain have sharp control over the Fourier transform of these measures at each scale of our construction. A key strategy is to obtain high probability bounds controlling the Fourier transform of functions on the sets we choose using Hoeffding's inequality.

\begin{theorem}[Hoeffding's Inequality]
    Let $\{ X_i \}$ be an independant family of $N$ mean-zero random variables, such that $|X_i| \leq A$ for each $i$. Then for each $t > 0$,
    %
    \[ \PP \left( \left| \frac{1}{N} \sum X_i \right| \geq t \right) \leq 2 \exp \left( (N/A^2) \cdot (- t^2) \right). \]
\end{theorem}

As with Theorem \ref{mainTheorem}, we perform a multi-scale analysis, using the notations introduced in Section \ref{sec:Dyadics}. Lemma \ref{discretefouriermeasures} implies that we only need control over integer-valued frequencies. The discretized measures $\{ \nu_k \}$ we select are, for each $k$, a sum of point mass distributions at the points $\ZZ/N_1 \dots N_k$. Therefore, $\widehat{\nu_k}$ will be $N_1 \dots N_k$ periodic, in the sense that for any $m \in (N_1 \dots N_k) \ZZ$ and $\xi \in \RR$, $\widehat{\nu_k}(\xi + m) = \widehat{\nu_k}(\xi)$. Since we are only concerned with integer valued frequencies, it will therefore suffice to control the Fourier transform of $\nu_k$ on frequencies lying in $\{ 1, \dots, N_1 \dots N_k \}$.

In the discrete lemma below, we rely on a variant of the proof strategy of Theorem 2.1 of \cite{Shmerkin}, but modified so that we can allow the branching factors $\{ N_k \}$ to increase arbitrarily fast. For each $\DQ_k$ discretized set $E \subset [0,1]$, we define a probability measure
%
\[ \nu_E = \frac{1}{\#(\DQ_k(E))} \sum_{Q \in \DQ_k(E)} \delta(a(Q)), \]
%
where for each $x \in \RR$, $\delta(x)$ is the Dirac delta measure at $x$, and for each $Q \in \DQ_k$, $a(Q)$ is the startpoint of the interval $Q$. Also, for each $k$, we define a probability measure
%
\[ \eta_k = \frac{1}{N_{k+1}} \sum_{i_1, \dots, i_d = 0}^{N_{k+1}} \delta \left( \frac{i}{N_1 \dots N_{k+1}} \right).  \]
%
The purpose of introducing $\eta_k$ is so that, given a measure $\mu$ which is a sum of point mass distributions in $\ZZ/N_1 \dots N_k$, the probability measure $\mu * \eta_k$ is a sum of point mass distributions in $\ZZ/N_1 \dots N_{k+1}$, uniformly distributed at the scale $1/N_1 \dots N_{k+1}$.

%Our goal now is now to carefully modify the discrete selection strategy and discretized probability measures we use, so that with high probability, the measures have the appropriate Fourier decay for the Fourier dimension bound we wish to obtain. Surprisingly, here we only need to perform a single scale analysis with the family of cubes $\DQ^d$, rather than a multi scale analysis involving the cubes $\DQ^d$ and $\DR^d$ as in Chapter \ref{ch:RoughSets}.

\begin{lemma} \label{discreteFourierBuildingBlock}
    Fix $s \in [1,dn)$, and $\varepsilon \in [0,(n-s)/4)$. Let $T \subset \RR$ be a nonempty, $\DQ_k$ discretized set, and let $B \subset \RR^n$ be a nonempty $\DQ_{k+1}$ discretized set such that
    %
    \begin{equation} \label{equation982589128942189}
    \begin{split}
        \#(\DQ_{k+1}(B)) \leq N_{k+1}^{s + \varepsilon}
    \end{split}
    \end{equation}
    %  \leq N_{k+1}^d
    %
    Then there exists a constant $A(n,s)$ such that, provided
    %
    \begin{equation} \label{equation5523786128439}
        M_{k+1}^{\frac{n}{n - s - 2\varepsilon}} \leq N_{k+1} \leq 2 M_{k+1}^{\frac{n}{n - s - 2\varepsilon}},
    \end{equation}
    %
    \begin{equation} \label{equation189248914891}
        \quad N_{k+1} \geq 3^{1/\varepsilon},
    \end{equation}
    %
    % TODO: FIX THIS EQUATION SO IT IS ACTUALLY THE ONE NEEDED TO BE USED
    \begin{equation} \label{equation8941894189238912}
        N_{k+1} \geq 24 N_1 \dots N_k,
    \end{equation}
    %
    and
    %
    \begin{equation} \label{equation77871247817841278}
        N_{k+1} \geq (1/\varepsilon)^{1/\varepsilon}
    \end{equation}
    %
    then there exists a $\DQ_{k+1}$ discretized set $S \subset T$, satisfying the following properties:
    %
    \begin{enumerate}
        \item[(A)] For any collection of $n$ distinct cubes $Q_1, \dots, Q_n \in \DQ_{k+1}(S)$,
        %
        \[ Q_1 \times \dots \times Q_n \not \in \DQ_{k+1}(B). \]

        \item[(B)] For any $m \in \ZZ$,
        %
        \[ |\widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m)| \leq A(n,s) \cdot (N_1 \dots N_{k+1})^{-\frac{n - s}{2n} + 2\varepsilon}. \]
    \end{enumerate}
\end{lemma}
\begin{proof}
    For each $R \in \DR_{k+1}(T)$, let $Q_R$ be randomly selected from $\DQ_{k+1}(R)$, such that the collection $\{ Q_R \}$ forms an independant family of random variables. Then, set $S = \bigcup \{ Q_R: R \in \DR_{k+1}(T) \}$. We then have
    %
    \begin{equation} \label{equation6900921094190290}
        \#(\DQ_{k+1}(S)) = \#(\DR_{k+1}(T)) = M_{k+1} \cdot \DQ_k(T).
    \end{equation}
    %
    Without loss of generality, removing cubes from $B$ if necessary, we may assume that for every cube $Q_1 \times \dots \times Q_n \in \DQ_{k+1}(B)$, the values $Q_1, \dots, Q_n$ occur in distinct intervals in $\DR_{k+1}(T)$. In particular, given any such cube, just as in Lemma \ref{discretelemma}, we have
    %
    \begin{equation} \label{equation12043910293120909}
        \mathbf{P}(Q_1 \times \dots Q_n \in \DQ_{k+1}(S^n)) = (M_{k+1}/N_{k+1})^n.
    \end{equation}
    %
    Thus \eqref{equation982589128942189}, \eqref{equation5523786128439}, and \eqref{equation12043910293120909} imply
    %
    \begin{equation} \label{equation999992482}
        \mathbf{E} \left[ \#(\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n)) \right] \leq M_{k+1}^n/N_{k+1}^{n - (s + \varepsilon)} \leq 1/N_{k+1}^\varepsilon.
    \end{equation}
    %
    Markov's inequality, together with \eqref{equation189248914891} and \eqref{equation999992482}, imply
    %
    \begin{equation} \label{fourierdim2}
    \begin{split}
        \mathbf{P}(\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n) \neq \emptyset) &= \mathbf{P}(\# (\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n)) \geq 1)\\
        &\leq 1/N_{k+1}^\varepsilon \leq 1/3.
    \end{split}
    \end{equation}
    %
    Thus $\DQ_{k+1}(S^n)$ is disjoint from $\DQ_{k+1}(B)$ with high probability.

    Now we analyze the Fourier transform of the measures $\nu_S$. For each cube $R \in \DR_{k+1}(T)$, and for each $m \in \ZZ$, let
    %
    \[ A_R(m) = e^{\frac{-2 \pi i m \cdot a(Q_R)}{N_1 \dots N_{k+1}}} - \frac{1}{N_{k+1}} \sum_{l = 0}^{N_{k+1} - 1} e^{\frac{-2 \pi i m \cdot [N_{k+1} a(Q) + l]}{N_1 \dots N_{k+1}}}. \]
    %
    Then $\EE[A_R(m)] = 0$, $|A_R(m)| \leq 2$ for each $m$, and
    %
    \[ \widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m) = \frac{1}{\#(\DR_{k+1}(T))} \sum_{R \in \DR_{k+1}(T)} A_R(m). \]
    %
    Now fix a particular value of $m$. Since the random variables $\{ A_R(m) : R \in \DR_{k+1}(T) \}$ are bounded, and independant from one another, we can apply Hoeffding's inequality to conclude that for each $t > 0$,
    %
    \begin{equation} \label{equation5551902402919120}
    \begin{split}
        \PP \left( |\widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m)| \geq t \right) &\leq 2 \exp \left( \frac{\#(\DR_{k+1}(T))}{4} \cdot (-t^2) \right)\\
        &= 2 \exp \left( \frac{\#(\DQ_k(T)) M_{k+1}}{4} \cdot (-t^2) \right).
    \end{split}
    \end{equation}
    %
    The function $\widehat{\nu_S} - \widehat{\eta_{k+1}} \widehat{\nu_T}$ is $N_1 \dots N_{k+1}$ periodic. Thus, to uniformly bound this function, we need only bound the function over $N_1 \dots N_{k+1}$ values. Applying a union bound with \eqref{equation5551902402919120}, we conclude
    %
    \[ \PP \left( \| \widehat{\nu_S} - \widehat{\eta_{k+1}} \widehat{\nu_T} \|_{L^\infty(\ZZ)} \geq t \right) \leq 2N_1 \dots N_{k+1} \cdot \exp \left( \frac{\#(\DQ_k(T)) M_{k+1}}{4} \cdot (-t^2) \right). \]

    %
    In particular, \eqref{equation5523786128439} shows
    %
    \begin{align*}
        \PP & \left( \| \widehat{\nu_S} - \widehat{\eta_{k+1}} \widehat{\nu_T} \|_{L^\infty(\ZZ)} \geq (N_1 \dots N_1 M_{k+1})^{-1/2} \log(M_{k+1}) \right)\\
        &\ \ \ \ \leq 2N_1 \dots N_{k+1} \cdot \exp \left( - \frac{\#(\DQ_k(T)) \log(M_{k+1})^2}{4 N_1 \dots N_k} \right)\\
        &\ \ \ \ \leq 2 N_1 \dots N_k \exp \left( \log(N_{k+1}) - \frac{\log(M_{k+1})^2}{4 N_1 \dots N_k} \right)\\
        &\ \ \ \ \leq 4 N_1 \dots N_k \exp \left( \log(N_{k+1}/2) - \frac{\left( \frac{n-s}{2n} \right)^2}{N_1 \dots N_k} \log(N_{k+1}/2)^2 \right).
    \end{align*}
    %
    Since \eqref{equation8941894189238912} holds, we conclude
    %
    \begin{equation} \label{equation90120931902390190}
        \PP \left( \| \widehat{\nu_S} - \widehat{\eta_{k+1}} \widehat{\nu_T} \|_{L^\infty(\ZZ)} \geq M_{k+1}^{-1/2} \log(M_{k+1}) \right) \leq 1/3.
    \end{equation}
    %
    Taking a union bound over \eqref{fourierdim2} and \eqref{equation90120931902390190}, we conclude that there is a non-zero probability that the set $S$ satisfies Property (A), and
    %
    \[ \| \widehat{\nu_S} - \widehat{\eta_{k+1}} \widehat{\nu_T} \|_{L^\infty(\ZZ)} \leq (N_1 \dots N_k M_{k+1})^{-1/2} \log(M_{k+1}). \]
    %
    But since \eqref{equation77871247817841278} holds,
    % \log(x) \leq x^\varepsilon
    % 1/\varepsilon^{1/\varepsilon} \leq x
    % N_{k+1} \geq 1/\varepsilon^{1/\varepsilon}
    %
    \begin{align*}
        (N_1 \dots N_k M_{k+1}^{-1/2} \log(M_{k+1}) &\lesssim_{n,s} \log(N_{k+1}) (N_1 \dots N_{k+1})^{- \frac{n-s-2\varepsilon}{2n}}\\
        &\leq (N_1 \dots N_{k+1})^{- \frac{n-s}{2n} + 2\varepsilon},
    \end{align*}
    %
    which shows the set $S$ also satisfies Property (B) with an appropriately chosen constant $A(n,s)$.
\end{proof}

\begin{comment}

Let us describe the measures we construct. For each $k$, we let
%
\[ \psi_k = N_1 \dots N_k \cdot \mathbf{I}_{\left[ 0, \frac{1}{N_1 \dots N_k} \right]}. \]
%
Then for each $\xi \in \RR^d$,
%
\[ |\widehat{\psi_k}(\xi)| = \left| N_1 \dots N_k \cdot \frac{e^{- \frac{2 \pi i \xi}{N_1 \dots N_k}} - 1}{- 2\pi i \xi} \right| \lesssim \frac{N_1 \dots N_k}{1 + |\xi|}. \]
%
Thus $\widehat{\psi_k}$ has fast decay for $|\xi| \geq N_1 \dots N_k$. For any $\DQ_k$ discretized set $E$, we let $\mu_E$ by the absolutely continuous probability measure with density function
%
\[ \frac{d\mu_E}{dx} = \frac{1}{\#(\DQ_k(E))} \sum_{Q \in \DQ_k(E)} \mathbf{I}_Q. \]
%
Then $\mu_E$ is supported on $E$. Since $\mu_E$ can be viewed as a convolution of $\psi_k$ with a discrete probability measure at the left-hand edges of the intervals in $\DQ_k(E)$, for each $\xi \in \RR^d$,
%
\[ |\widehat{\mu_E}(\xi)| \leq |\widehat{\psi_k}(\xi)| \lesssim \frac{N_1 \dots N_k}{1 + |\xi|}. \]
%
Thus $\widehat{\mu_E}$ has large decay for frequencies of large magnitude, and it suffices to construct $E$ such that we can control the Fourier transform of $\mu_E$ on low magnitude frequencies. To prove this, we take $E$ to be a random set, and apply Hoeffding's inequality to obtain tail bounds on the magnitude of the Fourier transform.

\begin{theorem}[Hoeffding's Inequality]
    Let $\{ X_i \}$ be a family of $N$ independant, mean zero random variables, such that $|X_i| \leq B$ for all $i$. Then
    %
    \[ \PP \left( \sum X_i \geq t \right) \leq 2 \exp \left( \frac{-t^2}{2B^2 N} \right). \]
\end{theorem}

\begin{lemma} \label{discreteFourierBuildingBlock}
    Fix $s \in [1,n)$, $\varepsilon_1 \in [0,(n-s)/4)$, and $\varepsilon_2 \in (0,\infty)$. Let $T \subset \RR$ be a nonempty, $\DQ_k$ discretized set, and let $B \subset \RR^n$ be a nonempty $\DQ_{k+1}$ discretized set such that
    %
    \begin{equation} \label{equation982589128942189}
    \begin{split}
        \#(\DQ_{k+1}(B)) \leq N_{k+1}^{s + \varepsilon_1}.
    \end{split}
    \end{equation}
    %  \leq N_{k+1}^d
    %
    Then there exists a constant $A(d,n,s)$ such that, provided
    %
    \begin{equation} \label{equation5523786128439}
        M_{k+1}^{\frac{dn}{dn - s - 2\varepsilon}} \leq N_{k+1} \leq 2 M_{k+1}^{\frac{dn}{dn - s - 2\varepsilon}},
    \end{equation}
    %
    \begin{equation} \label{equation189248914891}
        \quad N_{k+1} \geq 3^{1/\varepsilon},
    \end{equation}
    %
    and
    %
    \begin{equation} \label{equation77871247817841278}
        N_{k+1} \geq 3^{1/d} \left( \left\lceil \frac{A(d,n,s)}{\varepsilon} \right\rceil! \right)^{3/d} (N_1 \dots N_k),
    \end{equation}
    %
    then there exists a $\DQ_{k+1}$ discretized set $S \subset T$, satisfying the following properties:
    %
    \begin{enumerate}
        \item[(A)] For any collection of $n$ distinct cubes $Q_1, \dots, Q_n \in \DQ_{k+1}(S)$,
        %
        \[ Q_1 \times \dots \times Q_n \not \in \DQ_{k+1}(B). \]

        \item[(B)] For any $m \in \ZZ$,
        %
        \[ |\widehat{\mu_S}(m) - \widehat{\mu_T}(m)| \leq N_{k+1}^{-(1 - \varepsilon_2) \frac{n - s}{2n}}. \]
    \end{enumerate}
\end{lemma}
\begin{proof}
    For each $R \in \DR_{k+1}(T)$, let $Q_R$ be randomly selected from $\DQ_{k+1}(R)$, independently from all other selections $Q_{R'}$. Then, set $S = \bigcup \{ Q_R: R \in \DR_{k+1}(T) \}$. We then have
    %
    \[ \#(\DQ_{k+1}(S)) = \#(\DR_{k+1}(T)) = M_{k+1}^d \DQ_k(T). \]
    %
    Without loss of generality, removing cubes from $B$ if necessary, we may assume that every cube $Q_1 \times \dots \times Q_n \in \DQ_{k+1}(B)$, the values $Q_1, \dots, Q_n$ are distinct. In particular, given any such cube, just as in Lemma \ref{discretelemma}, we have
    %
    \[ \mathbf{P}(Q_1 \times \dots Q_n \in \DQ_{k+1}(S^n)) = (M_{k+1}/N_{k+1})^n. \]
    %
    Thus \eqref{equation982589128942189} and \eqref{equation5523786128439} imply
    %
    \[ \mathbf{E}(\#(\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n))) \leq M_{k+1}^n/N_{k+1}^{n - (s + \varepsilon_1)} \leq 1/N_{k+1}^{\varepsilon_1}. \]
    %
    Markov's inequality, together with \eqref{equation189248914891} implies
    %
    \begin{equation} \label{fourierdim2}
    \begin{split}
        \mathbf{P}(\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n) \neq \emptyset) &= \mathbf{P}(\# (\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n)) \geq 1)\\
        &\leq 1/N_{k+1}^\varepsilon \leq 1/3.
    \end{split}
    \end{equation}
    %
    Thus $\DQ_{k+1}(S^n)$ is disjoint from $\DQ_{k+1}(B)$ with high probability.

    Now we analyze the Fourier transform of the measure $\mu_S$. For each $R \in \DR_{k+1}(T)$, and $m \in \ZZ$, let
    %
    \[ A_R(m) = \int_R \left( \mu_S(x) - \mu_T(x) \right) e^{-2 \pi i m \cdot x}\; dx. \]
    %
    We note that for each $Q \in \DQ_{k+1}(R)$, and $x \in Q^\circ$,
    %
    \begin{align*}
        \EE(\mu_S(x) - \mu_T(x)) &= (N_1 \dots N_{k+1}) \frac{\PP(Q_R = 1)}{\#(\DQ_{k+1}(S))} - (N_1 \dots N_k) \frac{1}{\#(\DQ_k(T)}\\
        &= (N_1 \dots N_{k+1}) \frac{(M_{k+1}/N_{k+1})}{M_{k+1} \cdot \#(\DQ_k(T))} - (N_1 \dots N_k) \frac{1}{\#(\DQ_k(T))} = 0.
    \end{align*}
    %
    Thus
    %
    \[ \EE[A_R(m)] = \int_R \EE \left[ \mu_S(x) - \mu_T(x) \right] e^{-2 \pi i m \cdot x}\; dx = 0. \]
    %
    Notice that for each fixed $m$, the family $\{ A_R(m) \}$ are a family of $M_{k+1} \cdot \DQ_k(T)$ independant random variables, and
    %
    \[ |A_R(m)| \leq \int_R |\mu_S(x) - \mu_T(x)|\; dx = \frac{2}{M_{k+1}}. \]
    %
    We note that
    %
    \[ \widehat{\mu_S}(m) - \widehat{\mu_T}(m) = \sum_{R \in \DR_{k+1}(T)} A_R(m). \]
    %
    Applying Hoeffding's inequality, we conclude that for each $t > 0$,
    %
    \[ \PP \left( \left| \widehat{\mu_S}(m) - \widehat{\mu_T}(m) \right| \geq t \right) \leq 2 \exp \left( \frac{- M_{k+1}}{8 \cdot \#(\DQ_k(T))} \cdot t^2 \right). \]
    %
    In particular,
    %
    \begin{equation} \label{equation68994812893189}
        \PP \left( \left| \widehat{\mu_S}(m) - \widehat{\mu_T}(m) \right| \geq N_{k+1}^{-(1 - \varepsilon_2) \frac{n-s}{2n}} \right) \leq 2 \exp \left( \frac{-M_{k+1} N_{k+1}^{-(1 - \varepsilon_2) \frac{n-s}{n}}}{8 \cdot \#(\DQ_k(T))} \right).
    \end{equation}
    %
    Applying a union bound with \eqref{equation68994812893189}, we conclude that if
    %
    \[ I = \{ m \in \ZZ : |m| \leq (N_1 \dots N_k)^{A} \}, \]
    %
    then
    %
    \[ \PP \left( \left\| \widehat{\mu_S} - \widehat{\mu_T} \right\|_{L^\infty(I)} \geq N_{k+1}^{- \left(1 - \varepsilon_2 \right) \frac{n-s}{2n}} \right) \leq 2 (N_1 \dots N_k)^A \exp \left( \frac{-M_{k+1} N_{k+1}^{-(1 - \varepsilon_2) \frac{n-s}{n}}}{8 \cdot \#(\DQ_k(T))} \right). \]
    %
    But if $|m| \geq (N_1 \dots N_k)^A$, then
    %
    \[ \PP \left( \widehat{\mu_S}(m) \right) \]



    For each cube $R \in \DR_{k+1}(T)$, and for each $m$, let
    %
    \[ A_R(m) = e^{\frac{-2 \pi i m \cdot a(Q_R)}{N_1 \dots N_{k+1}}} - \frac{1}{N_{k+1}^d} \sum_{k_1, \dots, k_d = 0}^N e^{\frac{-2 \pi i m \cdot [N_{k+1} a(Q) + k]}{N_1 \dots N_{k+1}}}. \]
    %
    Then $\EE[A_R(m)] = 0$, $|A_R(m)| \leq 2$ for each $m$, and
    %
    \[ \widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m) = \frac{1}{\#(\DR_{k+1}(T))} \sum_{R \in \DR_{k+1}(T)} A_R(m). \]
    %
    Now fix a particular value of $m$. Since the random variables $A_R(m)$ are independant from one another as $R$ ranges over $\DR_{k+1}(T)$, we can apply Hoeffding's inequality to conclude that for each $t > 0$,
    %
    \[ \PP \left( |\widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m)| \geq t \right) \leq e^{-\#(\DR_{k+1}(T)) t^2/2} = e^{-\#(\DQ_k(T)) M_{k+1}^d t^2/2}. \]
    %
    In particular,
    %
    \[ \PP \left( |\widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m)| \geq M_{k+1}^{-d/2 - \varepsilon} \right) \leq \exp(- \#(\DQ_k(T)) M_{k+1}^\varepsilon / 2 ). \]
    %
    The function $\widehat{\nu_S} - \widehat{\eta_{k+1}}$ is $N_1 \dots N_{k+1}$ periodic. Thus, to uniformly bound $\widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m)$, we need only bound the function over $(N_1 \dots N_{k+1})^d$ values. Applying a union bound with \eqref{equation5523786128439}, we find that
    %
    \begin{equation} \label{equation81298398120412}
    \begin{split}
        \PP \left( \| \widehat{\nu_S} - \widehat{\eta_{k+1}} \widehat{\nu_T} \|_{L^\infty(\ZZ^d)} \geq M_{k+1}^{- d/2 - \varepsilon} \right) &\leq (N_1 \dots N_{k+1})^d \exp \left( - \#(\DQ_k(T)) M_{k+1}^\varepsilon / 2 \right)\\
        &\leq 2^{\lceil \frac{4d^2n}{\varepsilon(dn - s)} \rceil} \left\lceil \frac{4d^2n}{\varepsilon(dn-s)} \right\rceil! \frac{(N_1 \dots N_{k+1})^d}{M_{k+1}^{4d^2n/(dn - s)}}\\
        &\leq 2^{\lceil 8d^2n/(dn - s) \rceil} \left\lceil \frac{4d^2n}{\varepsilon(dn-s)} \right\rceil! \frac{(N_1 \dots N_k)^d}{N_{k+1}^d}\\
        &\leq \left( \left\lceil \frac{4d^2n}{\varepsilon(dn-s)} \right\rceil! \right)^3 \frac{(N_1 \dots N_k)^d}{N_{k+1}^d}.
    \end{split}
    \end{equation}
    %
    Note that
    %
    \begin{equation} \label{equation8998724714871}
        M_{k+1}^{-d/2 - \varepsilon} \lesssim N_{k+1}^{-(1 - 2\varepsilon/d) \frac{dn - s - 2\varepsilon}{2n}} \leq N_{k+1}^{-(1 - \varepsilon) \frac{dn - s - 2\varepsilon}{2n}}.
    \end{equation}
    %
    If we set $A(d,n,s) = (4d^2n/(dn - s))$, then \eqref{equation77871247817841278}, \eqref{equation81298398120412}, and \eqref{equation8998724714871} allow us to conclude that
    %
    \begin{equation} \label{equation1241751}
        \PP \left( \| \widehat{\nu_S} - \widehat{\eta_{k+1}} \widehat{\nu_T} \|_{L^\infty(\ZZ^d)} \geq N_{k+1}^{-(1 - \varepsilon)} \right) \leq 1/3.
    \end{equation}
    %
    Taking a union bound over \eqref{fourierdim2} and \eqref{equation1241751}, we find there is a non-zero probability that a set $S$ exists satisfying Property (A) and (B).
    \begin{comment}

    %
    Then for each $m \in \mathbf{Z}^d$,
    %
    \[ \widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m) = \sum_{Q \in \DQ_{k+1}(T)} A_Q e^{-\frac{2 \pi i m \cdot a(Q)}{N_1 \dots N_{k+1}}}. \]
    %
    We calculate that for each $Q \in \DQ_{k+1}(T)$,
    %
    \begin{align*}
        \EE[A_Q|\#(\DQ_k(S))] &= \frac{\PP (X_Q = 1 | \#(\DQ_k(S)))}{\#(\DQ_{k+1}(S))} - \frac{1}{N_{k+1}^d \#(\DQ_{k+1}(T))}\\
        &= \frac{\#(\DQ_{k+1}(S)) / N_{k+1}^d \#(\DQ_{k+1}(T))}{\#(\DQ_{k+1}(S))} - \frac{1}{N_{k+1}^d \#(\DQ_{k+1}(T))} = 0.
    \end{align*}
    %
    In particular, $\EE[A_Q] = 0$. Now for each $q \geq 1$,
    %
    \begin{align*}
        \EE[A_Q^q|\DQ_{k+1}(S)] &= \frac{\PP(X_Q = 1 | \DQ_{k+1}(S))}{\#(\DQ_{k+1}(S))^q} &= \frac{1}{\#(\DQ_{k+1}(T)) \cdot \#(\DQ_{k+1}(S))^{q-1}}.
    \end{align*}
    %
    Thus
    %
    \begin{align*}
        \EE[A_Q^q] &= \frac{1}{\#(\DQ_{k+1}(T))} \EE \left[ \frac{1}{\#(\DQ_{k+1}(S))^{q-1}} \right]\\
        &\leq s
    \end{align*}


    Now fix $m \in \{ -N_1 \dots N_{k+1}, N_1 \dots N_{k+1} \}^d$.



    We can then apply Hoeffding's inequality to conclude that for each $t > 0$,
    %
    \begin{align*}
        \PP \left( |\widehat{\nu_S}(m)| \geq \frac{t p \cdot \#(\DQ_{k+1}(T))^{1/2}}{\#(\DQ_{k+1}(S))} \right) &= \PP \left( \sum \left| \#(\DQ_{k+1}(S)) A_Q e^{-\frac{2 \pi i m \cdot a(Q)}{N_1 \dots N_{k+1}}} \right| \geq A \right) \\
        &\leq 2 \cdot \exp \left( - 2 t^2) \right)
    \end{align*}
    %
    If we now take a union bound over all $m \in \{ -N_1 \dots N_{k+1}, \dots, N_1 \dots N_{k+1} \}^d$, we can guarantee that
    %
    \begin{equation} \label{fourierdim3}
        \mathbf{P} \left( |\widehat{f}(m)| \leq \log(N_{k+1})/S\ \text{for all $m \in \{ -N, \dots, N\}^d$} \right) \geq 1 - 2^{d+1}/N^{c \log N - d}.
    \end{equation}
    %
    Since $\widehat{\nu_S}$ is $N_1 \dots N_{k+1}$ periodic, this means we can control all integer values of $\widehat{\nu_S}$ with high probability.

    Combining \eqref{fourierdim1}, \eqref{fourierdim2}, and \eqref{fourierdim3}, we conclude that there exists a constant $C$ such that with probability at least
    %
    \[ 1 - 2 \exp \left( \frac{-N^{d-s/n}}{A^{1/n} (\log N)^{1/n}} \right) - 1/\log N - \frac{2^{d+1}}{N^{c \log N - d}} \geq 1 - C / \log N, \]
    %
    the set $X$ avoids $K$, and for all $m \in \{ -N, \dots, N \}^d$,
    %
    \[ |\widehat{f}(m)| \leq \frac{C (\log N)^{1-1/n}}{N^{d-s/n}}. \qedhere \]



    Let
    %
    \[ p = \frac{1}{(N_{k+1}^{s + \varepsilon} \log(N_{k+1}))^{1/n}}, \]
    %
    and let $\{ X_Q \}$ be a family of independent and identically distributed $\{ 0, 1 \}$ valued Bernoulli random variables, for each $Q \in \DQ_{k+1}(T)$, such that $\PP(X_Q = 1) = p$. Then, define $S = \bigcup \{ Q : X_Q = 1 \}$. Then $\#(\DQ_{k+1}(S)) = \sum_Q X_Q$ is the sum of $\#(\DQ_k(T)) \cdot N_{k+1}^d$ independant and identically distributed random variables, and so Chernoff's inequality implies that
    %
    \[ \PP \left( \left| \#(\DQ_{k+1}(S)) - p \cdot \DQ_k(T) \cdot N_{k+1}^d \right| \leq \frac{p \cdot \# \DQ_k(T) \cdot N_{k+1}^d}{2} \right) \leq 10 e^{- p \DQ_k(T) N_{k+1}^d}. \]
    %
    Substituting in the value of $p$, we conclude
    %
    \begin{equation} \label{fourierdim1}
    \begin{split}
        \PP& \left( \left| \#(\DQ_{k+1}(S)) - \frac{\#(\DQ_k(T)) N_{k+1}^{\frac{dn - (s + \varepsilon)}{n}}}{\log(N_{k+1})^{1/n}} \right| \leq \frac{\#(\DQ_k(T)) N_{k+1}^{\frac{dn - (s + \varepsilon)}{n}}}{2 \log(N_{k+1})^{1/n}} \right)\\
        &\ \ \ \ \ \ \ \ \ \ \leq 10 \exp \left( \frac{- N_{k+1}^{\frac{dn - (s + \varepsilon)}{n}} \cdot \DQ_k(T)}{\log(N_{k+1})^{1/n}} \right)\\
        &\ \ \ \ \ \ \ \ \ \ \leq 10 \exp \left( \frac{-N_{k+1}^{\frac{dn - (s + \varepsilon)}{n}}}{\log(N_{k+1})^{1/n}} \right)
    \end{split}
    \end{equation}
    %
    Thus $S$ is the union of a large number of cubes, with high probability.

    Without loss of generality, removing cubes from $B$ if necessary, we may assume that every cube $Q_1 \times \dots \times Q_n \in \DQ_{k+1}(B)$, the values $Q_1, \dots, Q_n$ are distinct. Just as in Lemma

    In particular, given any such cube, we have
    %
    \[ \mathbf{P}(Q_1 \times \dots Q_n \subset S) = \mathbf{P}(X_{Q_1} = 1, \dots, X_{Q_n} = 1) = p^n. \]
    %
    Thus
    %
    \[ \mathbf{E}(\#(\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n))) \leq N_{k+1}^{s+\varepsilon} p^n = \log(N_{k+1})^{-1}. \]
    %
    Markov's inequality implies
    %
    \begin{equation} \label{fourierdim2}
    \begin{split}
        \mathbf{P}(\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n) \neq \emptyset) &= \mathbf{P}(\# (\DQ_{k+1}(B) \cap \DQ_{k+1}(S^n)) \geq 1)\\
        &\leq \log(N_{k+1})^{-1}.
    \end{split}
    \end{equation}
    %
    Thus $\DQ_{k+1}(S^n)$ is disjoint from $\DQ_{k+1}(B)$ with high probability.

    Now we analyze the Fourier transform of the measure $\nu_S$. For each cube $Q \in \DR_{k+1}(T)$, we can define
    %
    \[ A_Q = \nu_S(a(Q)) - (\eta_{k+1} * \nu_T)(a(Q)) = \begin{cases} \frac{1}{\#(\DQ_{k+1}(S))} - \frac{1}{N_{k+1}^d \#(\DQ_k(T))} &: X_Q = 1, \\ - \frac{1}{ N_{k+1}^d \#(\DQ_k(T))} &: X_Q = 0. \end{cases} \]
    %
    Then for each $m \in \mathbf{Z}^d$,
    %
    \[ \widehat{\nu_S}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_T}(m) = \sum_{Q \in \DQ_{k+1}(T)} A_Q e^{-\frac{2 \pi i m \cdot a(Q)}{N_1 \dots N_{k+1}}}. \]
    %
    We calculate that for each $Q \in \DQ_{k+1}(T)$,
    %
    \begin{align*}
        \EE[A_Q|\#(\DQ_k(S))] &= \frac{\PP (X_Q = 1 | \#(\DQ_k(S)))}{\#(\DQ_{k+1}(S))} - \frac{1}{N_{k+1}^d \#(\DQ_{k+1}(T))}\\
        &= \frac{\#(\DQ_{k+1}(S)) / N_{k+1}^d \#(\DQ_{k+1}(T))}{\#(\DQ_{k+1}(S))} - \frac{1}{N_{k+1}^d \#(\DQ_{k+1}(T))} = 0.
    \end{align*}
    %
    In particular, $\EE[A_Q] = 0$. Now for each $q \geq 1$,
    %
    \begin{align*}
        \EE[A_Q^q|\DQ_{k+1}(S)] &= \frac{\PP(X_Q = 1 | \DQ_{k+1}(S))}{\#(\DQ_{k+1}(S))^q} &= \frac{1}{\#(\DQ_{k+1}(T)) \cdot \#(\DQ_{k+1}(S))^{q-1}}.
    \end{align*}
    %
    Thus
    %
    \begin{align*}
        \EE[A_Q^q] &= \frac{1}{\#(\DQ_{k+1}(T))} \EE \left[ \frac{1}{\#(\DQ_{k+1}(S))^{q-1}} \right]\\
        &\leq s
    \end{align*}


    Now fix $m \in \{ -N_1 \dots N_{k+1}, N_1 \dots N_{k+1} \}^d$.



    We can then apply Hoeffding's inequality to conclude that for each $t > 0$,
    %
    \begin{align*}
        \PP \left( |\widehat{\nu_S}(m)| \geq \frac{t p \cdot \#(\DQ_{k+1}(T))^{1/2}}{\#(\DQ_{k+1}(S))} \right) &= \PP \left( \sum \left| \#(\DQ_{k+1}(S)) A_Q e^{-\frac{2 \pi i m \cdot a(Q)}{N_1 \dots N_{k+1}}} \right| \geq A \right) \\
        &\leq 2 \cdot \exp \left( - 2 t^2) \right)
    \end{align*}
    %
    If we now take a union bound over all $m \in \{ -N_1 \dots N_{k+1}, \dots, N_1 \dots N_{k+1} \}^d$, we can guarantee that
    %
    \begin{equation} \label{fourierdim3}
        \mathbf{P} \left( |\widehat{f}(m)| \leq \log(N_{k+1})/S\ \text{for all $m \in \{ -N, \dots, N\}^d$} \right) \geq 1 - 2^{d+1}/N^{c \log N - d}.
    \end{equation}
    %
    Since $\widehat{\nu_S}$ is $N_1 \dots N_{k+1}$ periodic, this means we can control all integer values of $\widehat{\nu_S}$ with high probability.

    Combining \eqref{fourierdim1}, \eqref{fourierdim2}, and \eqref{fourierdim3}, we conclude that there exists a constant $C$ such that with probability at least
    %
    \[ 1 - 2 \exp \left( \frac{-N^{d-s/n}}{A^{1/n} (\log N)^{1/n}} \right) - 1/\log N - \frac{2^{d+1}}{N^{c \log N - d}} \geq 1 - C / \log N, \]
    %
    the set $X$ avoids $K$, and for all $m \in \{ -N, \dots, N \}^d$,
    %
    \[ |\widehat{f}(m)| \leq \frac{C (\log N)^{1-1/n}}{N^{d-s/n}}. \qedhere \]
%\end{comment}
\end{proof}
\end{comment}

The remainder of the construction follows essentially the construction of the configuration avoiding set in Chapter \ref{ch:RoughSets}, obtaining a family of discretized sets $\{ X_k \}$ with $X = \bigcap X_k$. As in Chapter \ref{ch:RoughSets}, Property (A) of Lemma \eqref{discreteFourierBuildingBlock} is sufficient to guarantee that $X$ avoids the configuration $\C$. The remainder of this section is devoted to showing that Property (B) of Lemma \eqref{discreteFourierBuildingBlock} is sufficient to guarantee a Fourier dimension bound under the additional assumption that for each $\varepsilon > 0$,
%
\begin{equation} \label{equation41028694692} (N_1 \dots N_k) \lesssim_\varepsilon N_{k+1}^\varepsilon, \end{equation}
%
the set $X$ has the Fourier dimension guaranteed by Theorem \ref{FourierTheorem}.

The measures $\nu_{X_k}$ do not quite suffice to construct a measure on $X$ with the appropriate Fourier decay. The reason for this is that the Fourier transforms of these measures do not actually have any decay, being periodic functions. We can fix this by convolving these measures with an appropriate function. For each $k$, let
%
\[ \psi_k(x) = (N_1 \dots N_k) \cdot \mathbf{I}_{\left[ 0, \frac{1}{N_1 \dots N_k} \right]}. \]
%
Then it is easy to calculate that
%
\begin{equation} \label{equation901418294891481792}
    |\widehat{\psi_k}(m)| \lesssim \min \left( 1, \frac{N_1 \dots N_k}{|m|} \right).
\end{equation}
%
We note that the measures $\mu_k = \nu_{X_k} * \psi_k$ are still supported on $X_k$, and
%
\[ \widehat{\mu_k}(\xi) = \widehat{\nu_{X_k}}(\xi) \widehat{\psi_k}(\xi). \]
%
We also note that $\psi_{k+1} = \psi_k * \eta_{k+1}$. Thus
%
\begin{equation} \label{equation6892489214781278}
\begin{split}
    |\widehat{\mu_{k+1}}(m) - \widehat{\mu_k}(m)| &= |\widehat{\psi_{k+1}}(m)| |\widehat{\nu_k}(m) - \widehat{\eta_{k+1}}(m) \widehat{\nu_k}(m)|.
\end{split}
\end{equation}
%
We can use \eqref{equation901418294891481792}, \eqref{equation6892489214781278}, and Property (B) of Lemma \ref{discreteFourierBuildingBlock} to obtain asymptotic bounds on $\widehat{\mu_k}$.

\begin{lemma}
    For each $\varepsilon \in (0, (n-s)/4]$, there exists a constant $C_\varepsilon > 0$ and an integer $K > 0$, such that for any integer $k \geq K$, and any $m \in \ZZ^d$,
    %
    \[ |\widehat{\mu_{X_k}}(m)| \leq C_\varepsilon k \cdot |m|^{- \left( \frac{n - s}{2n} - \varepsilon \right)}. \]
\end{lemma}
\begin{proof}
    We establish the result by induction. The theorem is surely true for $\mu_{X_0}$, since $X_0 = [0,1]$, so $\mu_{X_0}$ is the indicator function of an interval, so
    %
    \[ |\widehat{\mu}_{X_0}(m)| \lesssim \frac{1}{|m|}. \]
    %
    Now assume that for each $m \in \ZZ$,
    %
    \[ |\widehat{\mu}_{X_k}(m)| \leq C_\varepsilon k \cdot |m|^{- \left( \frac{n - s}{2n} - \varepsilon \right)}. \]
    %
    If $|m| \leq N_1 \dots N_{k+1}$, then \eqref{equation41028694692}, \eqref{equation6892489214781278}, and Property (B) of Lemma \eqref{discreteFourierBuildingBlock}, imply that
    %
    \[ |\widehat{\mu_{X_{k+1}}}(m) - \widehat{\mu_{X_k}}(m)| \leq A(n,s) (N_1 \dots N_{k+1})^{-\frac{n - s}{2n} + 2\varepsilon_{k+1}} \leq \frac{C_\varepsilon}{|m|^{\frac{n-s}{2n} - \varepsilon}}. \]
    %
    Conversely, if $|m| \geq N_1 \dots N_{k+1}$, then
    %
    \begin{align*}
        |\widehat{\mu_{X_{k+1}}}(m) - \widehat{\mu_{X_k}}(m)| &\lesssim \frac{(N_1 \dots N_k)^{1 - \frac{n-s}{2n} + 2\varepsilon_{k+1}}}{|m|}\\
        &\leq \frac{(N_1 \dots N_k)^{1 - \frac{n-s}{2n} + 2\varepsilon_{k+1}} |m|^{-1 + \frac{n-s}{2n} - \varepsilon}}{|m|^{\frac{n-s}{2n} - \varepsilon}}\\
        &\leq \frac{(N_1 \dots N_k)^{2\varepsilon_{k+1} - \varepsilon}}{|m|^{\frac{n-s}{2n} - \varepsilon}} \leq \frac{C_\varepsilon}{|m|^{\frac{n-s}{2n} - \varepsilon}}
    \end{align*}
    %
    Thus, either way, we find
    %
    \[ |\widehat{\mu_{X_{k+1}}}(m)| \leq \frac{C_\varepsilon}{|m|^{\frac{n-s}{2n} - \varepsilon}} + \frac{C_\varepsilon \cdot k}{|m|^{\frac{n-s}{2n} - \varepsilon}} \leq \frac{C_\varepsilon \cdot (k+1)}{|m|^{\frac{n-s}{2n} - \varepsilon}}. \qedhere \]
\end{proof}

The same argument as in Theorem \ref{massdistributionprinciplelem} shows that the sequence $\{ \mu_{X_k} \}$ is a Cauchy sequence under the weak $*$ topology. If we form the limit $\mu_X = \lim_{k \to \infty} \mu_{X_k}$, then the Fourier transforms $\widehat{\mu_{X_k}}$ converge pointwise to $\widehat{\mu_X}$. In particular, for each $\varepsilon > 0$ and $m \in \ZZ^d$, we conclude that
%
\[ |\widehat{\mu_X}(m)| \leq \limsup |\widehat{\mu_{X_k}}(m)| \leq C_\varepsilon |m|^{- \left( \frac{nd - s}{n} - \varepsilon \right)}. \]
%
Combined with Lemma \ref{discretefouriermeasures}, this implies $X$ has Fourier dimension $(nd - s)/n$.

\endinput